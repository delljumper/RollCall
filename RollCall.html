<!--
@Project 计时器
@authors zhangke (1350831467@qq.com)
@date    2017-03-17 14:27:54
@version 0.1
-->
<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>点名器</title>
    <style>
    <!-- 
    .button {
        width:100px;
        height:30px;
        background:#E27575;
        border:none;
        border-radius:3px;
        box-shadow:1px 1px 5px #B6B6B6;
        color:#FFF;
        display:inline-block;
        cursor:pointer;
        text-align:center;
        text-shadow:1px 1px 1px #9E3F3F;
        line-height:30px;
        margin:10px;
    }
    .button:hover {
        background: #CF7A7A;
    }
    -->
    </style>
</head>
<body>
    <div id="Boxs" style="width:550px;height:530px;margin:auto;">
        <div style="width:250px;height:100%;float:left;">
            <label for="text">请在此处粘贴名单:</label>
            <textarea id="text" name="text" style="width:200px;height:500px;" onfocus="Judon(false)" onblur="Judon(true)"></textarea>
        </div>
        <div style="width:300px;height:100%;float:left;">
            <div>
                <p id="p" style="width:250px;height:60px;margin:auto;margin-top:50px;font-size:30px;text-align:center;line-height:60px;background: #F7F7F7;"></p>
                <div style="width:248px;height:50px;margin:auto auto;">
                    <span id="strat" class="button" onclick="start()">开始</span>
                    <span id="stop" class="button" onclick="stop()">结束</span>
                </div>
            </div>
            <p>请先把名单粘贴到左边文本区域</p>
            <p>空格：开始/暂停</p>
        </div>
    </div>
    <p style="width:500px;height:30px;color:#666;text-align:center;margin:20px auto;font-size:12px;">Roll Call&#40;Alpha&#41;&nbsp;Copyright&copy;zhangke</p>
    <script type="text/javascript">
    var displayer = document.getElementById("p"); //时间显示器
    var status = 0,
        JudTrue = false,
        JudOn = false,
        JudBtn = "stop"; //计时状态
    var text;//名单
    var strs = new Array();//名单列表数组
    var sc = 0;//数组下标
    AutoDivHeight();
    /*自动垂直居中*/
    function AutoDivHeight() {
        var Div=document.getElementById('Boxs');
        var WinHeight=0;
        if (window.innerHeight)
            WinHeight=window.innerHeight;
        else if ((document.body)&&(document.body.clientHeight))
            WinHeight=document.body.clientHeight;
        if (document.documentElement&&document.documentElement.clientHeight)
            WinHeight=document.documentElement.clientHeight;
        Div.style.marginTop=(WinHeight-parseInt(Div.style.height))/2+'px';
    }

    var start=function() {
        if (JudBtn!="start") {//防止按钮重复点击
            text=document.getElementById("text").value;//获取名单
            if (text!="") {//非空值则执行下一步
                JudBtn="start";
                strs=text.split("\n");//分割名单为数组
                for (var i=0;i<strs.length;i++)//遍历数组，检查数组内的空值转义字符并删除
                    if (strs[i]==""||strs[i]==" "||strs[i]=="\n")
                        for (var j=i;j<strs.length;j++)
                            if (j==strs.length-1)
                                strs.length-=1;//数组长度缩减
                            else
                                strs[j]=strs[j+1];//补上空位
                status=setTimeout(beat, 10);//每0.01秒执行一次
            } else {
                displayer.innerHTML="请先输入名单！";//名单为空则显示提示
            }
        }
    }

    var stop = function() {
        if (JudBtn != "stop") {
            JudBtn = "stop";
            text = "";//停止
            for (var j = 0; j < strs.length; j++) {
                if (j >= sc)
                    strs[j] = strs[j + 1];
                if (j + 1 == strs.length)
                    strs.length -= 1;
                else {
                    (strs[j] != "" || strs[j] != "\n" || strs[j] != "undefined")
                    text += strs[j] + "\n";
                }
            }
            document.getElementById("text").value = text;
            clearTimeout(status);
        }
    }

    var beat = function() {
        sc++;
        if (sc >= strs.length)
            sc = 0;
        displayer.innerHTML = strs[sc];
        status = setTimeout(beat, 10);//每0.01秒循环一次
    }
    /*判断文本框焦点情况*/
    function Judon(dir) {
        JudOn = dir;
    }
    /*键盘控制*/
    function Controller(event) {
        "use strict";
        //alert(event.keyCode);
        //var Key=event.keyCode;
        if (JudOn) {
            if (event.keyCode == 32) {
                if (JudTrue) {
                    JudTrue = false;
                    stop();
                } else {
                    JudTrue = true;
                    start();
                }
            }
        }
    }
    window.onresize = autodivheight;
    document.onkeydown = Controller;
    </script>
</body>
</html>